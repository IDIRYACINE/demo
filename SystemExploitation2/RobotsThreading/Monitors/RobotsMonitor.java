package Monitors;

import java.util.concurrent.Semaphore;

public class RobotsMonitor implements IRobotsMonitor {
    private Semaphore mutex;
    private Semaphore[] piecesSemaphores ;
    private int[] piecesStock = {0,0,0};
    private int[] pieceAwait = {0,0};

    public RobotsMonitor() {
        mutex = new Semaphore(1);
        initPiecesSemaphore();
    }

    private void initPiecesSemaphore(){
        piecesSemaphores = new Semaphore[2];
        for (int i = 0 ; i <2 ; i++){
            piecesSemaphores[i] = new Semaphore(0);
        }
    }

    @Override
    public void acquireMutexPermission() {
        try {
            mutex.acquire();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    @Override
    public void releaseMutexPermission() {
        mutex.release();
    }

    @Override
    public void consumePiece(int pieceType) {
        piecesStock[pieceType] = piecesStock[pieceType] - 1;
        
    }

    @Override
    public boolean isPieaceAvaillable(int pieceType) {
        return piecesStock[pieceType] > 0 ;
        
    }

    @Override
    public void stockNewPiece(int pieceType) {
        piecesStock[pieceType]++;      
    }

    @Override
    public void awaitPiece(int pieceType) {
        pieceAwait[pieceType]++;
        try {
            piecesSemaphores[pieceType].acquire();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }        
    }

    @Override
    public boolean isAwaitingPiece(int pieceType) {
        return pieceAwait[pieceType] > 0 ;
    }

    @Override
    public void aquirePiece(int pieceType) {
        pieceAwait[pieceType]--;
        piecesSemaphores[pieceType].release();
        
    }

    
}
